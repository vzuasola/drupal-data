/*! Optimization 
 Matterhorn Optimization 
 Vladimir V. Zuasola 
 25-01-2016 */
!function($){Drupal.behaviors.blockDrag={attach:function(context,settings){if("undefined"!=typeof Drupal.tableDrag&&"undefined"!=typeof Drupal.tableDrag.blocks){var table=$("table#blocks"),tableDrag=Drupal.tableDrag.blocks;tableDrag.row.prototype.onSwap=function(swappedRow){checkEmptyRegions(table,this)},Drupal.theme.tableDragChangedWarning=function(){return'<div class="messages warning">'+Drupal.theme("tableDragChangedMarker")+" "+Drupal.t("The changes to these domains will not be saved until the <em>Save Domains</em> button is clicked.")+"</div>"},tableDrag.onDrop=function(){dragObject=this;var regionRow=$(dragObject.rowObject.element).prevAll("tr.region-message").get(0),regionName=regionRow.className.replace(/([^ ]+[ ]+)*region-([^ ]+)-message([ ]+[^ ]+)*/,"$2"),regionField=$("select.block-region-select",dragObject.rowObject.element);if(0==$("option[value="+regionName+"]",regionField).length)alert(Drupal.t("The block cannot be placed in this region.")),regionField.change();else if($(dragObject.rowObject.element).prev("tr").is(".region-message")){var weightField=$("select.block-weight",dragObject.rowObject.element),oldRegionName=weightField[0].className.replace(/([^ ]+[ ]+)*block-weight-([^ ]+)([ ]+[^ ]+)*/,"$2");regionField.is(".block-region-"+regionName)||(regionField.removeClass("block-region-"+oldRegionName).addClass("block-region-"+regionName),weightField.removeClass("block-weight-"+oldRegionName).addClass("block-weight-"+regionName),regionField.val(regionName))}},$("select.block-region-select",context).once("block-region-select",function(){$(this).change(function(event){var row=$(this).closest("tr"),select=$(this);tableDrag.rowObject=new tableDrag.row(row[0]);var region_message=table.find(".region-"+select[0].value+"-message"),region_items=region_message.nextUntil(".region-message, .region-title");region_items.length?region_items.last().after(row):region_message.after(row),checkEmptyRegions(table,tableDrag.rowObject),select.get(0).blur()})});var checkEmptyRegions=function(table,rowObject){$("tr.region-message",table).each(function(){$(this).prev("tr").get(0)==rowObject.element&&("keyboard"!=rowObject.method||"down"==rowObject.direction)&&rowObject.swap("after",this),$(this).next("tr").is(":not(.draggable)")||0==$(this).next("tr").length?$(this).removeClass("region-populated").addClass("region-empty"):$(this).is(".region-empty")&&$(this).removeClass("region-empty").addClass("region-populated")})}}}}}(jQuery);