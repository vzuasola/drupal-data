{
    "artifactory": {
        "username": "$CI_PROJECT_NAME",
        "password": "$ARTIFACTORY_PASSWORD",
        "permissions": [
            "r",
            "w"
        ],
        "instances": [
            "http://trc-ptc-afact01.msred.dom:8081/artifactory/$CI_PROJECT_NAME"
        ]
    },
    "package": {
        "steps": {
            "composer": {
                "dockerfile": "automation/Dockerfile.composer",
                "docker-image-suffix": "-composer",
                "options": [],
                "command": [
                    "install",
                    "-v",
                    "--no-interaction"
                ],
                "volumes": [
                    "$PWD:/var/www/html/app"
                ]
            },
            "yarn-install": {
                "dockerfile": "automation/Dockerfile.yarn",
                "docker-image-suffix": "-yarn",
                "options": [
                    "--env",
                    "DIRPATH=/app/devtool/"
                ],
                "command": [
                    "yarn",
                    "install"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            },
            "yarn-dist": {
                "dockerfile": "automation/Dockerfile.yarn",
                "docker-image-suffix": "-yarn",
                "options": [
                    "--env",
                    "DIRPATH=/app/devtool/"
                ],
                "command": [
                    "yarn",
                    "run",
                    "dist"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            },
            "package": {
                "dockerfile": "automation/Dockerfile.package",
                "docker-image-suffix": "-package",
                "options": [
                    "--env", "CI_PROJECT_NAME=$CI_PROJECT_NAME",
                    "--env", "VERSION=$VERSION",
                    "--env", "CI_PIPELINE_ID=$CI_PIPELINE_ID",
                    "--env", "ARTIFACTORY_PASSWORD=$ARTIFACTORY_PASSWORD"
                ],
                "command": [
                    "python",
                    "/app/automation/package.py",
                    "--configuration-file",
                    "/app/automation/package.json"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            },
            "mark as complete": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-mark-as-complete",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "CREATES=/app/automation/deployed/package.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/mark_as_complete.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            }
        }
    },
    "phpunit-sonarqube": {
        "steps": {
            "unit test": {
                "dockerfile": "automation/Dockerfile.phpqatools",
                "docker-image-suffix": "-phpqatools",
                "options": [],
                "command": [
                    "phpunit",
                    "--fail-on-warning",
                    "--fail-on-risky",
                    "--coverage",
                    "--log-junit=coverage/junit.xml",
                    "--coverage-clover=coverage/clover.xml"
                ],
                "volumes": [
                    "$PWD:/app"
                ],
                "skip": "true"
            },
            "sonarqube-scanner-preview": {
                "dockerfile": "automation/Dockerfile.sonarqube",
                "docker-image-suffix": "-sonarqube",
                "options": [],
                "command": [
                    "/sonar-scanner/bin/sonar-scanner",
                    "-Dsonar.host.url=$SONARQUBE_URL",
                    "-Dsonar.projectKey=$CI_PROJECT_NAME",
                    "-Dsonar.sources=./",
                    "-Dsonar.projectVersion=$VERSION",
                    "-Dsonar.analysis.mode=preview",
                    "-Dsonar.gitlab.commit_sha=$SONAR_COMMIT_SHA",
                    "-Dsonar.gitlab.ref_name=$CI_COMMIT_REF_NAME",
                    "-Dsonar.gitlab.project_id=$CI_PROJECT_ID",
                    "-Dsonar.gitlab.unique_issue_per_inline=true"
                ],
                "volumes": [
                    "$PWD:/app"
                ],
                "skip": "true"
            },
            "sonarqube-scanner": {
                "dockerfile": "automation/Dockerfile.sonarqube",
                "docker-image-suffix": "-sonarqube",
                "options": [
                    "--env",
                    "SONARQUBE_URL=$SONARQUBE_URL",
                    "--env",
                    "CI_PROJECT_NAME=$CI_PROJECT_NAME"
                ],
                "command": [
                    "/usr/bin/sonar-scanner",
                    "-Dsonar.host.url=$SONARQUBE_URL",
                    "-Dsonar.projectKey=$CI_PROJECT_NAME",
                    "-Dsonar.sources=./",
                    "-Dsonar.projectVersion=$VERSION"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            }
        }
    },
    "phpcs": {
        "steps": {
            "phpcs": {
                "dockerfile": "automation/Dockerfile.phpqatools",
                "docker-image-suffix": "-phpqatools",
                "options": [],
                "command": [
                    "phpcs"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            }
        }
    },
    "phpmd": {
        "steps": {
            "phpmd": {
                "dockerfile": "automation/Dockerfile.phpqatools",
                "docker-image-suffix": "-phpqatools",
                "options": [],
                "command": [
                    "phpmd",
                    "src/,templates/,app/,devtool/",
                    "text",
                    "codesize,cleancode,unusedcode,naming,design,controversial"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            }
        }
    },
    "sensiolab-security-checker": {
        "steps": {
            "sensiolab-security-checker": {
                "dockerfile": "automation/Dockerfile.phpqatools",
                "docker-image-suffix": "-phpqatools",
                "options": [],
                "command": [
                    "security-checker",
                    "security:check"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            }
        }
    },
    "code-scan": {
        "steps": {
            "authorize": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-authorize",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "AUTHORIZED_USERS=$MSGREEN_AUTHORIZED_USERS",
                    "--env",
                    "DEPENDS_ON=/app/automation/deployed/development.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/authorize.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            },
            "scan using hp fortify": {
                "dockerfile": "automation/Dockerfile.deploy",
                "docker-image-suffix": "-deploy",
                "options": [
                    "--env",
                    "TC_USERNAME=dafa-stack",
                    "--env",
                    "TC_PASSWORD=$MSGREEN_DEPLOY_PASSWORD",
                    "--env",
                    "TC_HOST=mic-tst-itass01.msgreen.dom",
                    "--env",
                    "TC_VERIFY_SSL=no",
                    "--env",
                    "TC_RECKLESS_MODE=yes"
                ],
                "command": [
                    "kick_and_monitor",
                    "--template-name",
                    "execute-code-scan",
                    "--extra-vars",
                    "version: $VERSION.$CI_PIPELINE_ID",
                    "--extra-vars",
                    "project: $CI_PROJECT_NAME",
                    "--extra-vars",
                    "commit-id: $CI_COMMIT_SHA",
                    "--extra-vars",
                    "apptype: java",
                    "--extra-vars",
                    "git_project_url: $CI_REPOSITORY_URL",
                    "--extra-vars",
                    "gitlab_user_email: $GITLAB_USER_EMAIL"
                ],
                "volumes": []
            },
            "mark as complete": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-mark-as-complete",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "CREATES=/app/automation/deployed/code-scan.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/mark_as_complete.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            }
        }
    },
    "deploy-development": {
        "steps": {
            "authorize": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-authorize",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "AUTHORIZED_USERS=$MSGREEN_AUTHORIZED_USERS",
                    "--env",
                    "DEPENDS_ON=/app/automation/deployed/package.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/authorize.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            },
            "deploy": {
                "dockerfile": "automation/Dockerfile.deploy",
                "docker-image-suffix": "-deploy",
                "options": [
                    "--env",
                    "TC_USERNAME=dafa-stack",
                    "--env",
                    "TC_PASSWORD=$MSGREEN_DEPLOY_PASSWORD",
                    "--env",
                    "TC_HOST=mic-tst-itass01.msgreen.dom",
                    "--env",
                    "TC_VERIFY_SSL=no",
                    "--env",
                    "TC_RECKLESS_MODE=yes"
                ],
                "command": [
                    "kick_and_monitor",
                    "--template-name",
                    "CMS: deploy - development environment",
                    "--extra-vars",
                    "version: $VERSION.$CI_PIPELINE_ID",
                    "--extra-vars",
                    "project: $CI_PROJECT_NAME"
                ],
                "volumes": []
            },
            "mark as complete": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-mark-as-complete",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "CREATES=/app/automation/deployed/development.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/mark_as_complete.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            }
        }
    },
    "integration-tests-development": {
        "steps": {
            "authorize": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-authorize",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "AUTHORIZED_USERS=$MSGREEN_AUTHORIZED_USERS",
                    "--env",
                    "DEPENDS_ON=/app/automation/deployed/development.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/authorize.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            },
            "trigger integration tests": {
                "dockerfile": "automation/Dockerfile.deploy",
                "docker-image-suffix": "-integration-tests",
                "options": [
                    "--env",
                    "TC_USERNAME=dafa-stack",
                    "--env",
                    "TC_PASSWORD=$INTEGRATION_TESTS_PASSWORD",
                    "--env",
                    "TC_HOST=msc-co-itass01.msorange.dom",
                    "--env",
                    "TC_VERIFY_SSL=no",
                    "--env",
                    "TC_RECKLESS_MODE=yes"
                ],
                "command": [
                    "kick_and_monitor",
                    "--template-name",
                    "Execute selenium integration tests",
                    "--extra-vars",
                    "version: $VERSION.$CI_PIPELINE_ID",
                    "--extra-vars",
                    "project: $CI_PROJECT_NAME",
                    "--extra-vars",
                    "test_type: build-sanity",
                    "--extra-vars",
                    "gitlab_user_email: $GITLAB_USER_EMAIL"
                ],
                "volumes": []
            },
            "mark as complete": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-mark-as-complete",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "CREATES=/app/automation/deployed/integration-tests-development.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/mark_as_complete.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            }
        }
    },
    "deploy-testing": {
        "steps": {
            "authorize": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-authorize",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "AUTHORIZED_USERS=$MSGREEN_AUTHORIZED_USERS",
                    "--env",
                    "DEPENDS_ON=/app/automation/deployed/development.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/authorize.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            },
            "deploy": {
                "dockerfile": "automation/Dockerfile.deploy",
                "docker-image-suffix": "-deploy",
                "options": [
                    "--env",
                    "TC_USERNAME=dafa-stack",
                    "--env",
                    "TC_PASSWORD=$MSGREEN_DEPLOY_PASSWORD",
                    "--env",
                    "TC_HOST=mic-tst-itass01.msgreen.dom",
                    "--env",
                    "TC_VERIFY_SSL=no",
                    "--env",
                    "TC_RECKLESS_MODE=yes"
                ],
                "command": [
                    "kick_and_monitor",
                    "--template-name",
                    "CMS: deploy - testing environment (QA)",
                    "--extra-vars",
                    "version: $VERSION.$CI_PIPELINE_ID",
                    "--extra-vars",
                    "project: $CI_PROJECT_NAME"
                ],
                "volumes": []
            },
            "mark as complete": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-mark-as-complete",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "CREATES=/app/automation/deployed/testing.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/mark_as_complete.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            }
        }
    },
    "integration-tests-test": {
        "steps": {
            "authorize": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-authorize",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "AUTHORIZED_USERS=$MSGREEN_AUTHORIZED_USERS",
                    "--env",
                    "DEPENDS_ON=/app/automation/deployed/testing.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/authorize.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            },
            "trigger integration tests": {
                "dockerfile": "automation/Dockerfile.deploy",
                "docker-image-suffix": "-integration-tests",
                "options": [
                    "--env",
                    "TC_USERNAME=dafa-stack",
                    "--env",
                    "TC_PASSWORD=$INTEGRATION_TESTS_PASSWORD",
                    "--env",
                    "TC_HOST=msc-co-itass01.msorange.dom",
                    "--env",
                    "TC_VERIFY_SSL=no",
                    "--env",
                    "TC_RECKLESS_MODE=yes"
                ],
                "command": [
                    "kick_and_monitor",
                    "--template-name",
                    "Execute selenium integration tests",
                    "--extra-vars",
                    "version: $VERSION.$CI_PIPELINE_ID",
                    "--extra-vars",
                    "project: $CI_PROJECT_NAME",
                    "--extra-vars",
                    "test_type: full-regression",
                    "--extra-vars",
                    "gitlab_user_email: $GITLAB_USER_EMAIL"
                ],
                "volumes": []
            },
            "mark as complete": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-mark-as-complete",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "CREATES=/app/automation/deployed/integration-tests-test.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/mark_as_complete.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            }
        }
    },
    "deploy-tct": {
        "steps": {
            "authorize": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-authorize",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "AUTHORIZED_USERS=$MSGREEN_AUTHORIZED_USERS",
                    "--env",
                    "DEPENDS_ON=/app/automation/deployed/development.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/authorize.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            },
            "deploy": {
                "dockerfile": "automation/Dockerfile.deploy",
                "docker-image-suffix": "-deploy",
                "options": [
                    "--env",
                    "TC_USERNAME=dafa-stack",
                    "--env",
                    "TC_PASSWORD=$MSGREEN_DEPLOY_PASSWORD",
                    "--env",
                    "TC_HOST=mic-tst-itass01.msgreen.dom",
                    "--env",
                    "TC_VERIFY_SSL=no",
                    "--env",
                    "TC_RECKLESS_MODE=yes"
                ],
                "command": [
                    "kick_and_monitor",
                    "--template-name",
                    "CMS: deploy - TCT environment",
                    "--extra-vars",
                    "version: $VERSION.$CI_PIPELINE_ID",
                    "--extra-vars",
                    "project: $CI_PROJECT_NAME"
                ],
                "volumes": []
            },
            "mark as complete": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-mark-as-complete",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "CREATES=/app/automation/deployed/testing.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/mark_as_complete.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            }
        }
    },
    "deploy-uat": {
        "steps": {
            "authorize": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-authorize",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "AUTHORIZED_USERS=$MSORANGE_AUTHORIZED_USERS",
                    "--env",
                    "DEPENDS_ON=/app/automation/deployed/testing.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/authorize.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            },
            "deploy": {
                "dockerfile": "automation/Dockerfile.deploy",
                "docker-image-suffix": "-deploy",
                "options": [
                    "--env",
                    "TC_USERNAME=dafa-stack",
                    "--env",
                    "TC_PASSWORD=$MSORANGE_DEPLOY_PASSWORD",
                    "--env",
                    "TC_HOST=msc-co-itass01.msorange.dom",
                    "--env",
                    "TC_VERIFY_SSL=no",
                    "--env",
                    "TC_RECKLESS_MODE=yes"
                ],
                "command": [
                    "kick_and_monitor",
                    "--template-name",
                    "CMS: deploy - uat environment",
                    "--extra-vars",
                    "version: $VERSION.$CI_PIPELINE_ID",
                    "--extra-vars",
                    "project: $CI_PROJECT_NAME"
                ],
                "volumes": []
            },
            "mark as complete": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-mark-as-complete",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "CREATES=/app/automation/deployed/uat.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/mark_as_complete.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            }
        }
    },
    "deploy-staging": {
        "steps": {
            "authorize": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-authorize",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "AUTHORIZED_USERS=$MSORANGE_AUTHORIZED_USERS",
                    "--env",
                    "DEPENDS_ON=/app/automation/deployed/testing.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/authorize.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            },
            "deploy": {
                "dockerfile": "automation/Dockerfile.deploy",
                "docker-image-suffix": "-deploy",
                "options": [
                    "--env",
                    "TC_USERNAME=dafa-stack",
                    "--env",
                    "TC_PASSWORD=$MSORANGE_DEPLOY_PASSWORD",
                    "--env",
                    "TC_HOST=msc-co-itass01.msorange.dom",
                    "--env",
                    "TC_VERIFY_SSL=no",
                    "--env",
                    "TC_RECKLESS_MODE=yes"
                ],
                "command": [
                    "kick_and_monitor",
                    "--template-name",
                    "CMS: deploy - staging environment",
                    "--extra-vars",
                    "version: $VERSION.$CI_PIPELINE_ID",
                    "--extra-vars",
                    "project: $CI_PROJECT_NAME"
                ],
                "volumes": []
            },
            "mark as complete": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-mark-as-complete",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "CREATES=/app/automation/deployed/staging.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/mark_as_complete.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            }
        }
    },
    "staging-signoff": {
        "steps": {
            "authorize": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-authorize",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "AUTHORIZED_USERS=$STAGING_SIGNOFF_USERS",
                    "--env",
                    "DEPENDS_ON=/app/automation/deployed/staging.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/script/authorize.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            },
            "mark as complete": {
                "dockerfile": "automation/Dockerfile.authorize",
                "docker-image-suffix": "-mark-as-complete",
                "options": [
                    "--env",
                    "USER=$GITLAB_USER_EMAIL",
                    "--env",
                    "CREATES=/app/automation/deployed/staging-signoff.jsonl"
                ],
                "command": [
                    "python",
                    "/app/automation/mark_as_complete.py"
                ],
                "volumes": [
                    "$PWD:/app"
                ]
            }
        }
    }
}
